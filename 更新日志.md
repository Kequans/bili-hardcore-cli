# 更新日志

## 2026-01-29 - 命令行版本重构

### 重大更新

#### 1. 移除GUI依赖，改为纯命令行版本
- ✅ 移除所有PyQt6相关依赖
- ✅ 改为纯命令行交互界面
- ✅ API密钥直接在代码中配置
- ✅ 保留所有核心答题功能

#### 2. 新增登录管理功能
- ✅ 主程序启动时自动检测登录状态
- ✅ 显示登录时间和剩余有效期
- ✅ 支持选择是否使用已保存的登录信息
- ✅ 新增 `check_login.py` - 查看登录状态工具
- ✅ 新增 `clear_login.py` - 清除登录信息工具
- ✅ 支持快速切换账号

#### 3. 新增AI功能验证工具
- ✅ 新增 `test_api.py` - API配置测试工具
- ✅ 新增 `test_ai_answer.py` - AI答题功能测试
- ✅ 新增 `monitor_api.py` - API调用实时监控
- ✅ 添加详细的调试日志输出

### 新增文件

#### 程序文件
- `cli_main.py` - 命令行版本主程序
- `test_api.py` - API配置测试工具
- `test_ai_answer.py` - AI答题功能测试工具
- `monitor_api.py` - API调用监控工具
- `check_login.py` - 查看登录状态工具
- `clear_login.py` - 清除登录信息工具
- `start_cli.sh` - 快速启动脚本（macOS/Linux）

#### 配置文件
- `requirements-cli.txt` - 命令行版本依赖列表

#### 文档文件
- `README.md` - 主要使用文档（已更新）
- `QUICKSTART.md` - 快速开始指南
- `更新日志.md` - 本文件

### 修改的文件

#### `bilibili-AIHardcore/tools/LLM/deepseek.py`
- 添加环境变量支持
- 优先使用环境变量中的API密钥
- 添加详细的调试日志输出

#### `.gitignore`
- 添加 `cli_main.py` 到忽略列表（保护API密钥）
- 添加 `.bili-hardcore/` 到忽略列表

### 功能改进

#### 登录管理
**改进前：**
- 需要手动删除文件才能切换账号
- 无法查看登录状态
- 不知道登录信息何时过期

**改进后：**
- 主程序启动时自动检测并询问
- 独立工具查看登录状态
- 独立工具清除登录信息
- 显示登录时间和剩余有效期

#### AI功能验证
**改进前：**
- 无法确认AI是否真的在工作
- 没有调试日志
- 无法监控API调用

**改进后：**
- 多个测试工具验证AI功能
- 详细的调试日志输出
- 实时监控API调用过程
- 清晰显示API请求和响应

#### 用户体验
**改进前：**
- 需要记住文件路径
- 操作不够直观
- 缺少状态提示

**改进后：**
- 一键操作，无需记忆路径
- 清晰的交互提示
- 详细的状态显示
- 友好的错误提示

### 使用方式变化

#### 启动程序
**原版（GUI）：**
```bash
python gui_main.py
```

**新版（CLI）：**
```bash
python cli_main.py
```

#### 切换账号
**原版：**
```bash
rm -rf ~/.bili-hardcore/auth.json
python gui_main.py
```

**新版：**
```bash
# 方法1：使用主程序
python cli_main.py
# 选择 n 清除旧登录信息

# 方法2：使用清除工具
python clear_login.py
python cli_main.py
```

#### 查看登录状态
**原版：**
- 无此功能

**新版：**
```bash
python check_login.py
```

#### 验证AI功能
**原版：**
- 无此功能

**新版：**
```bash
python test_api.py          # 测试API配置
python test_ai_answer.py    # 测试AI功能
python monitor_api.py       # 监控API调用
```

### 配置方式变化

#### API密钥配置
**原版（GUI）：**
- 运行时在界面中输入

**新版（CLI）：**
- 直接在 `cli_main.py` 代码中配置
- 支持环境变量

```python
# 在 cli_main.py 中配置
DEEPSEEK_API_KEY = "sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
DEEPSEEK_BASE_URL = "https://api.deepseek.com"
DEEPSEEK_MODEL = "deepseek-chat"
```

### 依赖变化

#### 移除的依赖
- `PyQt6` - GUI框架（不再需要）

#### 新增的依赖
- `openai` - OpenAI SDK（用于API调用）

#### 保留的依赖
- `requests` - HTTP请求
- `qrcode` - 二维码生成
- `pillow` - 图像处理
- 其他核心依赖

### 兼容性

#### 向后兼容
- ✅ 保留原有的核心功能模块
- ✅ 登录机制保持不变
- ✅ 答题流程保持不变
- ✅ 配置文件格式保持不变

#### 不兼容的变化
- ❌ 不再支持GUI界面
- ❌ API密钥配置方式改变
- ❌ 启动命令改变

### 技术细节

#### 登录信息存储
- **位置**: `~/.bili-hardcore/auth.json`
- **有效期**: 7天
- **内容**: access_token, csrf, mid, cookie
- **格式**: JSON

#### API调用
- **方式**: HTTP POST请求
- **地址**: `https://api.deepseek.com/chat/completions`
- **格式**: JSON
- **超时**: 30秒（可配置）

#### 日志输出
- **位置**: 命令行标准输出
- **级别**: INFO, WARNING, ERROR
- **格式**: 时间戳 + 级别 + 消息
- **调试**: 添加 `[DEBUG]` 标识

### 已知问题

无

### 计划功能

- [ ] 支持更多AI模型
- [ ] 答题历史记录
- [ ] 答题统计分析
- [ ] 多账号管理
- [ ] 定时答题

### 致谢

- 原项目：bilibili-AIHardcore
- AI模型：DeepSeek
- 测试用户：感谢所有测试用户的反馈

---

## 如何更新

### 从GUI版本迁移到CLI版本

1. **安装新依赖**
   ```bash
   pip install -r requirements-cli.txt
   ```

2. **配置API密钥**
   - 编辑 `cli_main.py`
   - 设置 `DEEPSEEK_API_KEY`

3. **测试配置**
   ```bash
   python test_api.py
   ```

4. **开始使用**
   ```bash
   python cli_main.py
   ```

### 保留GUI版本

如果你想保留GUI版本，可以：

1. 备份当前目录
2. GUI版本使用 `python gui_main.py`
3. CLI版本使用 `python cli_main.py`

两个版本可以共存，共享登录信息。

---

**更新完成！** 🎉

如有问题，请查看 `README.md` 或 `QUICKSTART.md`
